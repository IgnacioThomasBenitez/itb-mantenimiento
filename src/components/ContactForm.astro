<form id="contactForm" style="max-width: 42rem; margin: 0 auto; background-color: var(--color-itb-gray-dark); padding: 2rem; border-radius: 0.5rem; border: 2px solid var(--color-itb-gray);">
  <div style="margin-bottom: 1.5rem;">
    <label for="name" style="display: block; color: var(--color-itb-gray-light); margin-bottom: 0.5rem; font-weight: 500;">Nombre Completo</label>
    <input 
      type="text" 
      id="name" 
      name="from_name"
      required
      style="width: 100%; padding: 0.75rem 1rem; background-color: var(--color-itb-black); border: 2px solid var(--color-itb-gray); border-radius: 0.5rem; color: white; font-family: inherit; font-size: 1rem;"
      onfocus="this.style.borderColor='var(--color-itb-pink)'; this.style.outline='none';"
      onblur="this.style.borderColor='var(--color-itb-gray)';"
    >
  </div>

  <div style="margin-bottom: 1.5rem;">
    <label for="email" style="display: block; color: var(--color-itb-gray-light); margin-bottom: 0.5rem; font-weight: 500;">Email</label>
    <input 
      type="email" 
      id="email" 
      name="reply_to"
      required
      style="width: 100%; padding: 0.75rem 1rem; background-color: var(--color-itb-black); border: 2px solid var(--color-itb-gray); border-radius: 0.5rem; color: white; font-family: inherit; font-size: 1rem;"
      onfocus="this.style.borderColor='var(--color-itb-pink)'; this.style.outline='none';"
      onblur="this.style.borderColor='var(--color-itb-gray)';"
    >
  </div>

  <div style="margin-bottom: 1.5rem;">
    <label for="phone" style="display: block; color: var(--color-itb-gray-light); margin-bottom: 0.5rem; font-weight: 500;">Telefono</label>
    <input 
      type="tel" 
      id="phone" 
      name="phone"
      style="width: 100%; padding: 0.75rem 1rem; background-color: var(--color-itb-black); border: 2px solid var(--color-itb-gray); border-radius: 0.5rem; color: white; font-family: inherit; font-size: 1rem;"
      onfocus="this.style.borderColor='var(--color-itb-pink)'; this.style.outline='none';"
      onblur="this.style.borderColor='var(--color-itb-gray)';"
    >
  </div>

  <div style="margin-bottom: 1.5rem;">
    <label for="service" style="display: block; color: var(--color-itb-gray-light); margin-bottom: 0.5rem; font-weight: 500;">Servicio</label>
    <select 
      id="service" 
      name="service"
      required
      style="width: 100%; padding: 0.75rem 1rem; background-color: var(--color-itb-black); border: 2px solid var(--color-itb-gray); border-radius: 0.5rem; color: white; font-family: inherit; font-size: 1rem;"
      onfocus="this.style.borderColor='var(--color-itb-pink)'; this.style.outline='none';"
      onblur="this.style.borderColor='var(--color-itb-gray)';"
    >
      <option value="">Selecciona un servicio</option>
      <option value="Reparacion Hardware">Reparacion Hardware</option>
      <option value="Instalacion de Software">Instalacion de Software</option>
      <option value="Mantenimiento Preventivo">Mantenimiento Preventivo</option>
      <option value="Formateo e Instalacion SO">Formateo e Instalacion SO</option>
      <option value="Otro">Otro</option>
    </select>
  </div>

  <div style="margin-bottom: 1.5rem;">
    <label for="message" style="display: block; color: var(--color-itb-gray-light); margin-bottom: 0.5rem; font-weight: 500;">Mensaje</label>
    <textarea 
      id="message" 
      name="message" 
      rows="5"
      required
      style="width: 100%; padding: 0.75rem 1rem; background-color: var(--color-itb-black); border: 2px solid var(--color-itb-gray); border-radius: 0.5rem; color: white; resize: none; font-family: inherit; font-size: 1rem;"
      onfocus="this.style.borderColor='var(--color-itb-pink)'; this.style.outline='none';"
      onblur="this.style.borderColor='var(--color-itb-gray)';"
    ></textarea>
  </div>

  <button 
    type="submit"
    id="submitButton"
    style="width: 100%; background-color: var(--color-itb-pink); color: white; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer; font-size: 1rem; transition: all 0.3s ease;"
    onmouseover="this.style.backgroundColor='var(--color-itb-pink-dark)'; this.style.transform='scale(1.05)';"
    onmouseout="this.style.backgroundColor='var(--color-itb-pink)'; this.style.transform='scale(1)';"
  >
    Enviar Mensaje
  </button>

  <p id="statusMessage" style="margin-top:1rem; color: var(--color-itb-gray-light); text-align: center; display:none;"></p>
</form>

<script is:inline>
  function initContactForm() {
    if (typeof emailjs === 'undefined') {
      setTimeout(initContactForm, 100);
      return;
    }

    emailjs.init("0mfER7R_j1KtnPMs8");

    const form = document.getElementById("contactForm");
    const statusMessage = document.getElementById("statusMessage");
    const submitButton = document.getElementById("submitButton");

    if (form && !form.dataset.initialized) {
      form.dataset.initialized = "true";
      
      form.addEventListener("submit", function(e) {
        e.preventDefault();

        // Deshabilitar boton
        submitButton.disabled = true;
        submitButton.textContent = "Enviando...";

        statusMessage.style.display = "block";
        statusMessage.style.color = "var(--color-itb-gray-light)";
        statusMessage.textContent = "⏳ Enviando mensaje...";

        // Usar sendForm en lugar de send
        emailjs.sendForm(
          "service_icutguk",
          "template_l6pnmu5",
          form
        ).then(
          function(response) {
            console.log("SUCCESS!", response.status, response.text);
            statusMessage.style.color = "#22c55e";
            statusMessage.textContent = "✅ Mensaje enviado con exito!";
            form.reset();
            
            setTimeout(function() {
              statusMessage.style.display = "none";
              submitButton.disabled = false;
              submitButton.textContent = "Enviar Mensaje";
            }, 5000);
          },
          function(error) {
            console.error("FAILED...", error);
            statusMessage.style.color = "#ef4444";
            statusMessage.textContent = "❌ Error: " + (error.text || "Intenta nuevamente");
            submitButton.disabled = false;
            submitButton.textContent = "Enviar Mensaje";
          }
        );
      });
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
      script.onload = initContactForm;
      document.head.appendChild(script);
    });
  } else {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
    script.onload = initContactForm;
    document.head.appendChild(script);
  }
</script>